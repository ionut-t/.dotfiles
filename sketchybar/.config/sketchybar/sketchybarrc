#!/bin/bash

# Catppuccin Mocha palette
export BASE=0xff1e1e2e
export MANTLE=0xff181825
export SURFACE0=0xff313244
export SURFACE1=0xff45475a
export TEXT=0xffcdd6f4
export SUBTEXT=0xffa6adc8
export BLUE=0xff89b4fa
export MAUVE=0xffcba6f7
export GREEN=0xffa6e3a1
export RED=0xfff38ba8
export YELLOW=0xfff9e2af
export PEACH=0xfffab387
export TRANSPARENT=0x00000000

PLUGIN_DIR="$CONFIG_DIR/plugins"

# ── Bar appearance ──────────────────────────────────────────
sketchybar --bar \
  height=37 \
  blur_radius=30 \
  position=top \
  sticky=on \
  padding_left=10 \
  padding_right=10 \
  color=$BASE \
  border_width=0 \
  shadow=off

# ── Defaults ────────────────────────────────────────────────
sketchybar --default \
  icon.font="SF Pro:Semibold:14.0" \
  icon.color=$TEXT \
  label.font="SF Pro:Medium:13.0" \
  label.color=$TEXT \
  background.color=$TRANSPARENT \
  background.corner_radius=5 \
  background.height=26 \
  padding_left=2 \
  padding_right=2 \
  label.padding_left=4 \
  label.padding_right=6 \
  icon.padding_left=6 \
  icon.padding_right=4

# ── AeroSpace workspaces (left) ─────────────────────────────
sketchybar --add event aerospace_workspace_change
for sid in $(aerospace list-workspaces --all); do
  sketchybar --add item space.$sid left \
    --subscribe space.$sid aerospace_workspace_change \
    --set space.$sid \
      background.color=$SURFACE0 \
      background.corner_radius=5 \
      background.height=22 \
      background.drawing=off \
      label="$sid" \
      label.font="SF Mono:Bold:12.0" \
      label.color=$SUBTEXT \
      label.padding_left=8 \
      label.padding_right=8 \
      icon.drawing=off \
      drawing=off \
      click_script="aerospace workspace $sid" \
      script="$PLUGIN_DIR/aerospace.sh $sid"
done

# ── Front app (left) ────────────────────────────────────────
sketchybar --add item front_app left \
  --subscribe front_app front_app_switched \
  --set front_app \
    icon.drawing=off \
    label.font="SF Pro:Semibold:13.0" \
    label.color=$TEXT \
    padding_left=8 \
    script="$PLUGIN_DIR/front_app.sh"

# ── Clock (right) ───────────────────────────────────────────
sketchybar --add item clock right \
  --set clock \
    update_freq=10 \
    icon.drawing=off \
    label.font="SF Pro:Semibold:13.0" \
    label.color=$TEXT \
    script="$PLUGIN_DIR/clock.sh"

# ── Battery (right) ─────────────────────────────────────────
sketchybar --add item battery right \
  --subscribe battery system_woke power_source_change \
  --set battery \
    update_freq=120 \
    icon.font="SF Pro:Semibold:14.0" \
    label.font="SF Pro:Medium:13.0" \
    label.color=$TEXT \
    script="$PLUGIN_DIR/battery.sh"

# ── Force initial update ────────────────────────────────────
sketchybar --update
